function Visualizations(){$.get("./mapbox",function(a){Plotly.setPlotConfig({mapboxAccessToken:a.token})});this.magColor={0:"black",1:"red",2:"orange",3:"yellow",4:"green",5:"blue",6:"indigo",7:"violet"}}Visualizations.prototype.update=function(){var a=this,b=function(c){a.drawMap(c);a.drawChart(c);a.indicateLatest(c)};return $.get("./quakes").done(b)};Visualizations.prototype.drawMap=function(d){var a=this,c=[{type:"scattermapbox",mode:"markers",marker:{size:d.map(function(e){return e.mag*5}),color:d.map(function(e){return a.magColor[Math.round(e.mag)]})},lat:d.map(function(e){return e.lat}),lon:d.map(function(e){return e.lon}),text:d.map(function(e){return e.name})}],b={title:"Earthquakes",margin:{l:0,r:0,b:0,t:30,pad:4},mapbox:{style:"satellite-streets"}};Plotly.newPlot("quake-map",c,b,{responsive:true})};Visualizations.prototype.drawChart=function(d){var c={};d.forEach(function(f){var e=Math.round(f.mag);if(e in Object.keys(c)){c[e]+=1}else{c[e]=1}});var b=[{values:Object.values(c),labels:Object.keys(c),marker:{colors:Object.values(this.magColor)},type:"pie"}];var a={title:"Rounded Magnitudes",margin:{l:0,r:0,b:0,t:30,pad:4}};Plotly.newPlot("quake-chart",b,a,{responsive:true})};Visualizations.prototype.indicateLatest=function(c){var b=c[0],a=moment(b.time).format("MMMM Do YYYY [at] h:mm:ss a");$("#quake-latest .detail").text(b.name+" on "+a)};