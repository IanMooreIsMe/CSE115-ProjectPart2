var visualizations,auth,game,refresher,tl=new TimelineLite();tl.staggerFrom(".column",0.3,{opacity:0,ease:Power2.easeInOut},0.2);$(document).ready(function(){$(".menu .account").popup({on:"click",inline:true,hoverable:true,position:"bottom right",lastResort:"left center",delay:{show:300,hide:800}});game=new Game();visualizations=new Visualizations();auth=new Auth("form#auth");refresher=new Refresher()});function Refresher(){var a=this;this.refreshButton=$("#refresh");this.refreshIcon=this.refreshButton.children("i");this.refreshStatus=$("#refresh-status");this.tl=new TimelineLite();this.refreshable=true;this.refreshButton.click(function(){if(a.refreshable){a.refresh()}});setInterval(function(){if(a.refreshable&&document.hasFocus()){a.refresh()}},60000);a.refresh(true)}Refresher.prototype.refresh=function(b){var a=this;Promise.all([visualizations.update(),game.refresh()]).then(function(){a.refreshable=true;a.setStatus("Refreshed at "+moment().format("LTS"));a.tl.to(a.refreshIcon,0.75,{rotation:"+=360",ease:Power2.easeInOut})},function(){a.refreshable=false;if(b){setTimeout(function(){a.refresh(true)},2000)}a.setStatus("You are being ratelimited!",3000);a.tl.to(a.refreshIcon,0.75,{rotation:"+=180",ease:Bounce.easeOut}).to(a.refreshIcon,0.75,{rotation:"-=180",ease:Bounce.easeOut})})};Refresher.prototype.setStatus=function(c,d){var b=this,a=this.refreshStatus.text();this.refreshStatus.text(c);if(d!==undefined){this.refreshable=false;setTimeout(function(){b.refreshStatus.text(a);b.refreshable=true},d)}};