function Auth(b){this.form=$(b);this.form.inputs=this.form.find("input");this.form.buttons=this.form.find("button");this.form.createAccountButton=this.form.find("button[value=create]");this.form.loginButton=this.form.find("button[value=login]");this.form.logoutButton=this.form.find("button[value=logout]");this.usernameDisplay=$("#username");this.statusMessage=$("#auth-status");this.secureStatus=$("#secure-status");var a=this;this.form.submit(function(c){c.preventDefault()});this.form.buttons.click(function(g){g.preventDefault();var c=$(this),f=a.form.serializeArray(),d={};f.forEach(function(e){d[e.name]=e.value});d.action=c.val();a.submit(d)});this.refresh()}Auth.prototype.refresh=function(){var b=this,a=function(c){b.setUser(c.username)};$.get("/user").done(a);this.setSecureStatus(location.protocol==="https:")};Auth.prototype.submit=function(c){var b=this,a=function(){b.refresh();game.refresh()},d=function(){var e=c.action;if(e==="create"){b.setStatus("Failed to create account, username in use or password too short!")}else{if(e==="login"){b.setStatus("Failed to login, invalid username or password!")}}};$.post("/user",c).done(a).fail(d)};Auth.prototype.setUser=function(b){var a=(b!==null);this.form.inputs.prop("disabled",a).val(b);this.form.createAccountButton.prop("disabled",a);this.form.loginButton.prop("disabled",a);this.form.logoutButton.prop("disabled",!a);this.usernameDisplay.text(b||"Not signed in");this.setStatus(a?"Signed in":"Please sign in or create an account")};Auth.prototype.setStatus=function(a){this.statusMessage.text(a)};Auth.prototype.setSecureStatus=function(a){if(a){this.secureStatus.html("Secure<div class='detail'>Your connection is secure.</div>").removeClass("red").addClass("green")}else{this.secureStatus.html("DANGER<div class='detail'>Your connection is not secure!</div>").removeClass("green").addClass("red")}};